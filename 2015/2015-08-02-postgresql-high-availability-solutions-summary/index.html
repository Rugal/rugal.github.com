

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Rugal Bernstein">
  <meta name="keywords" content="">
  
    <meta name="description" content="Shared Disk FailoverOnly one copy of the database on shared file system.  No data loss if failover happens. If the shared disk array fails or becomes corrupt, all database servers are nonfunctional.">
<meta property="og:type" content="article">
<meta property="og:title" content="postgresql High Availability solutions summary">
<meta property="og:url" content="https://rugal.github.com/2015/2015-08-02-postgresql-high-availability-solutions-summary/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Shared Disk FailoverOnly one copy of the database on shared file system.  No data loss if failover happens. If the shared disk array fails or becomes corrupt, all database servers are nonfunctional.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2015-08-02T04:00:00.000Z">
<meta property="article:modified_time" content="2023-08-21T11:34:57.204Z">
<meta property="article:author" content="Rugal Bernstein">
<meta property="article:tag" content="postgresql">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>postgresql High Availability solutions summary - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"rugal.github.com","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="postgresql High Availability solutions summary"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2015-08-02 00:00" pubdate>
          August 2, 2015 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.9k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          42 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">postgresql High Availability solutions summary</h1>
            
            
              <div class="markdown-body">
                
                <link rel="stylesheet" type="text&#x2F;css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="Shared-Disk-Failover"><a href="#Shared-Disk-Failover" class="headerlink" title="Shared Disk Failover"></a>Shared Disk Failover</h2><p>Only one copy of the database on shared file system.</p>
<ol>
<li>No data loss if failover happens.</li>
<li>If the shared disk array fails or becomes corrupt, all database servers are nonfunctional. </li>
<li>Another issue is that the standby server should never access the shared storage while the primary server is running.</li>
<li><code>NAS</code> could be the solution.</li>
</ol>
<h2 id="File-System-Replication"><a href="#File-System-Replication" class="headerlink" title="File System Replication"></a>File System Replication</h2><p>Upgraded version of <code>Shared Disk Failover</code> solution. File system are mirrored to a file system residing on another computer.</p>
<ol>
<li>Writes to the standby must be done in the same order as those on the master.</li>
<li><code>DRBD</code> is a popular file system replication solution for Linux</li>
</ol>
<h2 id="Transaction-Log-Shipping"><a href="#Transaction-Log-Shipping" class="headerlink" title="Transaction Log Shipping"></a>Transaction Log Shipping</h2><p>Keep current by reading a stream of WAL records. </p>
<ol>
<li>If the main server fails, the standby contains <code>almost</code> all of the data of the main server, and can be quickly made the new master database server.</li>
<li>This can be synchronous or asynchronous and can only be done for the entire database server.</li>
<li>A standby server can also be used for read-only queries, in which case it is called a Hot Standby server</li>
</ol>
<h3 id="File-based-log-shipping"><a href="#File-based-log-shipping" class="headerlink" title="File-based log shipping"></a>File-based log shipping</h3><ol>
<li>Transferring WAL records one file (WAL segment) at a time. </li>
<li>The bandwidth required for this technique varies according to the transaction rate of the primary server. </li>
<li>Log shipping is <code>asynchronous</code>, i.e., the WAL records are shipped after transaction commit. As a result, there is a window for data loss should the primary server suffer a catastrophic failure; transactions not yet shipped will be lost. The size of the data loss window in file-based log shipping can be limited by use of the <code>archive_timeout</code> parameter, which can be set as low as a few seconds. </li>
<li>However such a low setting will substantially increase the bandwidth required for file shipping.</li>
</ol>
<h3 id="Streaming-replication"><a href="#Streaming-replication" class="headerlink" title="Streaming replication"></a>Streaming replication</h3><ol>
<li>Streaming replication allows a standby server to stay more up-to-date than is possible with file-based log shipping. </li>
<li>The standby connects to the primary, which streams WAL records to the standby as they are generated, without waiting for the WAL file to be filled.</li>
<li>Streams WAL changes incrementally over a network connection.</li>
<li>Record-based log shipping is more granular.</li>
<li>Streaming replication is <code>asynchronous</code> by <code>default</code>, in which case there is a small delay between committing a transaction in the primary and the changes becoming visible in the standby.</li>
<li>This delay is however much smaller than with file-based log shipping, typically under one second.</li>
<li>With streaming replication, <code>archive_timeout</code> is not required to reduce the data loss window</li>
</ol>
<h2 id="Trigger-Based-Master-Standby-Replication"><a href="#Trigger-Based-Master-Standby-Replication" class="headerlink" title="Trigger-Based Master-Standby Replication"></a>Trigger-Based Master-Standby Replication</h2><p>Master-standby replication setup sends all data modification queries to the master server.</p>
<ol>
<li>The master server <code>asynchronously</code> sends data changes to the standby server.</li>
<li>The standby can answer read-only queries while the master server is running. </li>
<li>The standby server is ideal for data warehouse queries.</li>
<li><code>Slony-I</code> is an example of this type of replication.</li>
<li>Because it updates the standby server asynchronously (in batches), there is possible data loss during failover.</li>
</ol>
<h2 id="Statement-Based-Replication-Middleware"><a href="#Statement-Based-Replication-Middleware" class="headerlink" title="Statement-Based Replication Middleware"></a>Statement-Based Replication Middleware</h2><p>With statement-based replication middleware, a program intercepts every SQL query and sends it to one or all servers.</p>
<ol>
<li>Each server operates independently. </li>
<li>Read-write queries must be sent to all servers, so that every server receives any changes. </li>
<li>But read-only queries can be sent to just one server, allowing the read workload to be distributed among them.</li>
<li>If query encounter situation such as <code>RANDOM()</code> which each server will generate different results, this might cause problem. Either the <code>middleware</code> or the application must query such values from a single server and then use those values in write queries. Another option is to use this replication option with a traditional master-standby setup.</li>
<li>Care must also be taken that all transactions either commit or abort on all servers, perhaps using two-phase commit.</li>
<li><code>Pgpool-II</code> and Continuent Tungsten are examples of this type of replication.</li>
</ol>
<h2 id="Asynchronous-Multimaster-Replication"><a href="#Asynchronous-Multimaster-Replication" class="headerlink" title="Asynchronous Multimaster Replication"></a>Asynchronous Multimaster Replication</h2><ol>
<li>Each server works independently, and periodically communicates with the other servers to identify conflicting transactions. </li>
<li>The conflicts can be resolved by users or conflict resolution rules. </li>
<li><code>Bucardo</code> is an example of this type of replication.</li>
</ol>
<h2 id="Synchronous-Multimaster-Replication"><a href="#Synchronous-Multimaster-Replication" class="headerlink" title="Synchronous Multimaster Replication"></a>Synchronous Multimaster Replication</h2><ol>
<li>Each server can accept write requests, and modified data is transmitted from the original server to every other server before each transaction commits. </li>
<li>Heavy write activity can cause excessive locking, leading to poor performance, often worse than that of a single server.</li>
<li>Read requests can be sent to any server.</li>
<li>Synchronous multimaster replication is best for mostly read workloads.</li>
<li>though its big advantage is that any server can accept write requests — there is no need to partition workloads between master and standby servers.</li>
<li>Because the data changes are sent from one server to another, there is no problem with non-deterministic functions like random().</li>
<li>PostgreSQL does not offer this type of replication, though PostgreSQL two-phase commit (PREPARE TRANSACTION and COMMIT PREPARED) can be used to implement this in application code or middleware.</li>
</ol>
<h2 id="Data-Partitioning"><a href="#Data-Partitioning" class="headerlink" title="Data Partitioning"></a>Data Partitioning</h2><ol>
<li>Data partitioning splits tables into data sets. </li>
<li>Each set can be modified by only one server.</li>
<li>If queries combining data from different servers are necessary, an application can query both servers, or master&#x2F;standby replication can be used to keep a read-only copy of the other data of server on each server.</li>
</ol>
<h2 id="Multiple-Server-Parallel-Query-Execution"><a href="#Multiple-Server-Parallel-Query-Execution" class="headerlink" title="Multiple-Server Parallel Query Execution"></a>Multiple-Server Parallel Query Execution</h2><p>This solution allows multiple servers to work concurrently on a single query.</p>
<ol>
<li>It is usually accomplished by splitting the data among servers and having each server execute its part of the query and return results to a central server where they are combined and returned to the user. </li>
<li><code>Pgpool-II</code> has this capability. </li>
<li>Also, this can be implemented using the <code>PL/Proxy</code> tool set.</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/operation/" class="category-chain-item">operation</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/postgresql/" class="print-no-link">#postgresql</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>postgresql High Availability solutions summary</div>
      <div>https://rugal.github.com/2015/2015-08-02-postgresql-high-availability-solutions-summary/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Rugal Bernstein</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 2, 2015</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2015/2015-08-17-ubuntu-restart-network-interfaces/" title="ubuntu restart network interfaces">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ubuntu restart network interfaces</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2015/2015-08-02-recovery-procedure-of-postgresql/" title="Recovery procedure of Postgresql">
                        <span class="hidden-mobile">Recovery procedure of Postgresql</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
